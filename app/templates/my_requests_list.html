<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>My Requests - 3D Print Queue</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-zinc-950 text-zinc-100">
  <div class="max-w-2xl mx-auto p-6">
    
    <!-- Header -->
    <div class="flex items-center justify-between mb-6">
      <div>
        <h1 class="text-2xl font-bold">üìã My Requests</h1>
        <p class="text-zinc-400 text-sm">{{ email }}</p>
      </div>
      <div class="flex gap-2">
        <a href="/queue" class="text-zinc-400 hover:text-zinc-200 text-sm">View Queue</a>
        <span class="text-zinc-600">|</span>
        <a href="/" class="text-indigo-400 hover:underline text-sm">+ New Request</a>
      </div>
    </div>
    
    {% if requests_list %}
      <!-- Requests List -->
      <div class="space-y-4">
        {% for req in requests_list %}
          {% set status_colors = {
            'NEW': 'bg-blue-600/20 border-blue-500/50 text-blue-300',
            'NEEDS_INFO': 'bg-orange-600/20 border-orange-500/50 text-orange-300',
            'APPROVED': 'bg-emerald-600/20 border-emerald-500/50 text-emerald-300',
            'PRINTING': 'bg-indigo-600/20 border-indigo-500/50 text-indigo-300',
            'DONE': 'bg-green-600/20 border-green-500/50 text-green-300',
            'PICKED_UP': 'bg-zinc-600/20 border-zinc-500/50 text-zinc-400',
            'REJECTED': 'bg-red-600/20 border-red-500/50 text-red-300',
            'CANCELLED': 'bg-zinc-600/20 border-zinc-500/50 text-zinc-400'
          } %}
          {% set status_icons = {
            'NEW': 'üìã',
            'NEEDS_INFO': '‚ö†Ô∏è',
            'APPROVED': '‚úì',
            'PRINTING': 'üñ®Ô∏è',
            'DONE': '‚úÖ',
            'PICKED_UP': 'üì¶',
            'REJECTED': '‚ùå',
            'CANCELLED': 'üö´'
          } %}
          
          <a href="/my/{{ req.id }}?token={{ req.access_token }}" 
             class="block bg-zinc-900/60 border border-zinc-800 hover:border-zinc-600 rounded-2xl p-5 transition
                    {% if req.status == 'NEEDS_INFO' %}border-orange-500/50 hover:border-orange-400{% endif %}">
            <div class="flex items-start justify-between gap-4">
              <div class="flex-1 min-w-0">
                <h3 class="font-semibold text-lg truncate">{{ req.print_name or 'Untitled Request' }}</h3>
                <p class="text-zinc-500 text-sm">Request #{{ req.id[:8] }}</p>
                
                <div class="flex flex-wrap gap-2 mt-3 text-xs">
                  <span class="px-2 py-1 bg-zinc-800 rounded-lg">{{ req.printer or 'ANY' }}</span>
                  <span class="px-2 py-1 bg-zinc-800 rounded-lg">{{ req.material }}</span>
                  {% if req.colors %}
                    <span class="px-2 py-1 bg-zinc-800 rounded-lg">{{ req.colors }}</span>
                  {% endif %}
                </div>
              </div>
              
              <div class="text-right flex-shrink-0">
                <span class="inline-block px-3 py-1 rounded-lg text-sm font-medium border {{ status_colors.get(req.status, 'bg-zinc-800 border-zinc-700') }}">
                  {{ status_icons.get(req.status, '') }} {{ req.status.replace('_', ' ') }}
                </span>
                <p class="text-zinc-500 text-xs mt-2">{{ req.created_at|localtime('%b %d, %Y') }}</p>
              </div>
            </div>
            
            {% if req.status == 'NEEDS_INFO' %}
              <div class="mt-3 pt-3 border-t border-orange-500/30 text-orange-300 text-sm">
                ‚ö†Ô∏è We need more information - click to respond
              </div>
            {% elif req.status == 'DONE' %}
              <div class="mt-3 pt-3 border-t border-green-500/30 text-green-300 text-sm">
                ‚úÖ Ready for pickup!
              </div>
            {% endif %}
          </a>
        {% endfor %}
      </div>
      
      <!-- Summary -->
      <div class="mt-6 p-4 bg-zinc-900/40 rounded-xl text-center text-sm text-zinc-400">
        {{ requests_list|length }} request{% if requests_list|length != 1 %}s{% endif %} total
      </div>
      
    {% else %}
      <!-- No Requests -->
      <div class="bg-zinc-900/60 border border-zinc-800 rounded-2xl p-8 text-center">
        <div class="text-4xl mb-4">üì≠</div>
        <h3 class="font-semibold text-lg mb-2">No requests found</h3>
        <p class="text-zinc-400 text-sm mb-4">You don't have any print requests yet.</p>
        <a href="/" class="inline-block rounded-xl bg-indigo-600 hover:bg-indigo-500 transition px-6 py-3 font-semibold">
          Submit a Request
        </a>
      </div>
    {% endif %}
    
    <!-- Footer -->
    <div class="mt-8 pt-4 border-t border-zinc-800 text-center text-xs text-zinc-500">
      <p class="mb-2">This link expires in 24 hours. <a href="/my-requests" class="text-indigo-400 hover:underline">Request a new link</a></p>
      <a href="/changelog" class="hover:text-indigo-400 transition">3D Print Queue v{{ version }}</a>
    </div>
  </div>
</body>
</html>
