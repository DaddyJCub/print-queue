<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Feature Flags | Printellect</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-zinc-950 text-zinc-100">
  <div class="max-w-7xl mx-auto p-6">
    {% set active_page = 'settings' %}
    {% include 'admin_nav.html' %}

    <!-- Settings Tabs -->
    {% set active_settings_tab = 'features' %}
    {% include '_components/settings_tabs.html' %}

    {% if success %}<div class="mb-6 bg-emerald-900/30 border border-emerald-500/50 text-emerald-200 rounded-xl p-4">{{ success }}</div>{% endif %}

    <!-- Warning Banner -->
    <div class="mb-6 bg-yellow-900/20 border border-yellow-600/30 rounded-xl p-4">
      <div class="flex items-start gap-3">
        <span class="text-yellow-400">‚ö†Ô∏è</span>
        <div>
          <div class="font-medium text-yellow-300">Experimental Features</div>
          <p class="text-sm text-zinc-400 mt-1">Some features are in development and may not work as expected.</p>
        </div>
      </div>
    </div>

    <!-- User Features -->
    <div class="mb-6">
      <h2 class="text-lg font-semibold mb-4">üë§ User Accounts</h2>
      <div class="space-y-3">
        {% for key in ['user_accounts', 'user_registration', 'user_password_auth'] %}
        {% set flag = flags.get(key) %}
        {% if flag %}
        <div class="bg-zinc-900/60 border border-zinc-800 rounded-xl p-4 flex items-center justify-between">
          <div class="flex-1">
            <div class="flex items-center gap-2">
              <span class="font-medium">{{ flag.key.replace('_', ' ').title() }}</span>
              {% if flag.enabled %}<span class="px-2 py-0.5 bg-emerald-600/20 text-emerald-300 text-xs rounded-lg">Enabled</span>
              {% else %}<span class="px-2 py-0.5 bg-zinc-700 text-zinc-400 text-xs rounded-lg">Disabled</span>{% endif %}
            </div>
            <p class="text-sm text-zinc-500 mt-1">{{ flag.description }}</p>
          </div>
          <label class="relative inline-flex items-center cursor-pointer ml-4">
            <input type="checkbox" class="sr-only peer" {% if flag.enabled %}checked{% endif %} onchange="toggleFlag('{{ flag.key }}', this.checked)">
            <div class="w-11 h-6 bg-zinc-700 rounded-full peer peer-checked:bg-indigo-600 peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all"></div>
          </label>
        </div>
        {% endif %}
        {% endfor %}
      </div>
    </div>

    <!-- Store Features -->
    <div class="mb-6">
      <h2 class="text-lg font-semibold mb-4">üè™ Store</h2>
      <div class="space-y-3">
        {% for key in ['store_public', 'store_payments', 'store_rewards', 'store_preorders'] %}
        {% set flag = flags.get(key) %}
        {% if flag %}
        <div class="bg-zinc-900/60 border border-zinc-800 rounded-xl p-4 flex items-center justify-between">
          <div class="flex-1">
            <div class="flex items-center gap-2">
              <span class="font-medium">{{ flag.key.replace('_', ' ').title() }}</span>
              {% if flag.enabled %}<span class="px-2 py-0.5 bg-emerald-600/20 text-emerald-300 text-xs rounded-lg">Enabled</span>
              {% else %}<span class="px-2 py-0.5 bg-zinc-700 text-zinc-400 text-xs rounded-lg">Disabled</span>{% endif %}
              {% if key in ['store_payments', 'store_rewards'] %}<span class="px-2 py-0.5 bg-yellow-600/20 text-yellow-300 text-xs rounded-lg">Beta</span>{% endif %}
            </div>
            <p class="text-sm text-zinc-500 mt-1">{{ flag.description }}</p>
          </div>
          <label class="relative inline-flex items-center cursor-pointer ml-4">
            <input type="checkbox" class="sr-only peer" {% if flag.enabled %}checked{% endif %} onchange="toggleFlag('{{ flag.key }}', this.checked)">
            <div class="w-11 h-6 bg-zinc-700 rounded-full peer peer-checked:bg-indigo-600 peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all"></div>
          </label>
        </div>
        {% endif %}
        {% endfor %}
      </div>
    </div>

    <!-- Advanced Features -->
    <div class="mb-6">
      <h2 class="text-lg font-semibold mb-4">‚öôÔ∏è Advanced</h2>
      <div class="space-y-3">
        {% for key in ['file_sync', 'multi_admin', 'audit_logging', 'octoprint_integration', 'auto_slicer', '3d_preview'] %}
        {% set flag = flags.get(key) %}
        {% if flag %}
        <div class="bg-zinc-900/60 border border-zinc-800 rounded-xl p-4 flex items-center justify-between">
          <div class="flex-1">
            <div class="flex items-center gap-2">
              <span class="font-medium">{{ flag.key.replace('_', ' ').replace('3d', '3D').title() }}</span>
              {% if flag.enabled %}<span class="px-2 py-0.5 bg-emerald-600/20 text-emerald-300 text-xs rounded-lg">Enabled</span>
              {% else %}<span class="px-2 py-0.5 bg-zinc-700 text-zinc-400 text-xs rounded-lg">Disabled</span>{% endif %}
              {% if key in ['octoprint_integration', 'auto_slicer', 'file_sync'] %}<span class="px-2 py-0.5 bg-orange-600/20 text-orange-300 text-xs rounded-lg">Coming Soon</span>{% endif %}
            </div>
            <p class="text-sm text-zinc-500 mt-1">{{ flag.description }}</p>
          </div>
          <label class="relative inline-flex items-center cursor-pointer ml-4">
            <input type="checkbox" class="sr-only peer" {% if flag.enabled %}checked{% endif %} onchange="toggleFlag('{{ flag.key }}', this.checked)">
            <div class="w-11 h-6 bg-zinc-700 rounded-full peer peer-checked:bg-indigo-600 peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all"></div>
          </label>
        </div>
        {% endif %}
        {% endfor %}
      </div>
    </div>

    <!-- UI Features -->
    <div class="mb-6">
      <h2 class="text-lg font-semibold mb-4">üé® UI / UX</h2>
      <div class="space-y-3">
        {% for key in ['dark_mode_toggle'] %}
        {% set flag = flags.get(key) %}
        {% if flag %}
        <div class="bg-zinc-900/60 border border-zinc-800 rounded-xl p-4 flex items-center justify-between">
          <div class="flex-1">
            <div class="flex items-center gap-2">
              <span class="font-medium">{{ flag.key.replace('_', ' ').title() }}</span>
              {% if flag.enabled %}<span class="px-2 py-0.5 bg-emerald-600/20 text-emerald-300 text-xs rounded-lg">Enabled</span>
              {% else %}<span class="px-2 py-0.5 bg-zinc-700 text-zinc-400 text-xs rounded-lg">Disabled</span>{% endif %}
            </div>
            <p class="text-sm text-zinc-500 mt-1">{{ flag.description }}</p>
          </div>
          <label class="relative inline-flex items-center cursor-pointer ml-4">
            <input type="checkbox" class="sr-only peer" {% if flag.enabled %}checked{% endif %} onchange="toggleFlag('{{ flag.key }}', this.checked)">
            <div class="w-11 h-6 bg-zinc-700 rounded-full peer peer-checked:bg-indigo-600 peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all"></div>
          </label>
        </div>
        {% endif %}
        {% endfor %}
      </div>
    </div>
  </div>

  <script>
  async function toggleFlag(key, enabled) {
    try {
      const response = await fetch('/admin/features/' + key + '/toggle', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ enabled: enabled }) });
      if (!response.ok) throw new Error('Failed');
      location.reload();
    } catch (e) { alert('Failed to update feature flag'); location.reload(); }
  }
  </script>
</body>
</html>
