{# Admin Navigation Component - Clean and Modern #}
{# Usage: {% include 'admin_nav.html' %} with active_page variable set #}

<nav class="admin-nav bg-zinc-900/95 backdrop-blur-lg border-b border-zinc-800 sticky top-0 z-50 -mx-6 -mt-6 mb-6">
  <div class="max-w-7xl mx-auto px-4 sm:px-6">
    <div class="flex items-center justify-between h-14">
      <!-- Brand -->
      <div class="flex items-center gap-3">
        <a href="/" class="flex items-center gap-2 hover:opacity-80 transition" title="Back to site">
          <img src="/static/icons/logo.png" alt="" class="h-8 w-8 rounded-lg">
          <span class="font-bold text-lg hidden sm:block">Printellect</span>
        </a>
        <span class="text-xs bg-amber-500/20 text-amber-400 px-2 py-0.5 rounded-full font-medium">Admin</span>
      </div>
      
      {% set design_feature_on = design_enabled if design_enabled is defined else True %}
      {% set can_design_nav = design_feature_on and ((current_admin_can_manage_designs if current_admin_can_manage_designs is defined else False) or ((current_admin.role == 'designer') if current_admin is defined else False)) %}

      <!-- Desktop Navigation -->
      <div class="hidden md:flex items-center">
        <!-- Primary Nav Pills -->
        <div class="flex items-center bg-zinc-800/50 rounded-xl p-1 gap-0.5">
          <a href="/admin" class="admin-pill {% if active_page == 'queue' %}active{% endif %}">
            ğŸ“‹ <span>Queue</span>
          </a>
          <a href="/admin/shipping" class="admin-pill {% if active_page == 'shipping' %}active{% endif %}">
            ğŸ“¦ <span>Shipping</span>
          </a>
          {% if can_design_nav %}
          <a href="/admin?design=1" class="admin-pill {% if active_page == 'design' %}active{% endif %}">
            ğŸ¨ <span>Design</span>
          </a>
          {% endif %}
          <a href="/admin/store" class="admin-pill {% if active_page == 'store' %}active{% endif %}">
            ğŸª <span>Store</span>
          </a>
          <a href="/admin/analytics" class="admin-pill {% if active_page == 'analytics' %}active{% endif %}">
            ğŸ“Š <span>Stats</span>
          </a>
          <a href="/admin/accounts" class="admin-pill {% if active_page == 'accounts' or active_page == 'users' %}active{% endif %}">
            ğŸ‘¥ <span>Users</span>
          </a>
        </div>
        
        <div class="w-px h-6 bg-zinc-700 mx-3"></div>
        
        <!-- More Menu -->
        <div class="relative" id="more-dropdown-container">
          <button onclick="toggleMoreDropdown()" class="admin-pill text-zinc-400 hover:text-white">
            âš™ï¸ <span>More</span>
            <svg class="w-3 h-3 ml-0.5 transition-transform" id="more-chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>
          </button>
          
          <div id="more-dropdown" class="hidden absolute top-full right-0 mt-2 w-52 bg-zinc-900 border border-zinc-700 rounded-xl shadow-2xl overflow-hidden z-50">
            <div class="p-1.5">
              <a href="/admin/printer-settings" class="dropdown-item {% if active_page == 'printers' %}active{% endif %}">
                ğŸ–¨ï¸ Printers
              </a>
              <a href="/admin/settings" class="dropdown-item {% if active_page == 'settings' %}active{% endif %}">
                âš™ï¸ Settings
              </a>
              <a href="/admin/features" class="dropdown-item {% if active_page == 'features' %}active{% endif %}">
                âœ¨ Features
              </a>
              <a href="/admin/printellect/devices" class="dropdown-item {% if active_page == 'printellect-devices' %}active{% endif %}">
                ğŸ“Ÿ Printellect Devices
              </a>
              <a href="/admin/printellect/releases" class="dropdown-item {% if active_page == 'printellect-releases' %}active{% endif %}">
                ğŸ“¦ Printellect Releases
              </a>
            </div>
            <div class="border-t border-zinc-800 p-1.5">
              <a href="/admin/feedback" class="dropdown-item {% if active_page == 'feedback' %}active{% endif %}">
                ğŸ“¬ Feedback
              </a>
              <a href="/admin/broadcast" class="dropdown-item {% if active_page == 'broadcast' %}active{% endif %}">
                ğŸ“¢ Broadcast
              </a>
              <a href="/admin/audit" class="dropdown-item {% if active_page == 'audit' %}active{% endif %}">
                ğŸ“œ Audit Log
              </a>
            </div>
            <div class="border-t border-zinc-800 p-1.5">
              <a href="/admin/file-sync" class="dropdown-item text-zinc-500 {% if active_page == 'file-sync' %}active{% endif %}">
                ğŸ“ File Sync
              </a>
              <a href="/admin/debug" class="dropdown-item text-zinc-500 {% if active_page == 'debug' %}active{% endif %}">
                ğŸ”§ Debug
              </a>
            </div>
          </div>
        </div>
        
        <div class="w-px h-6 bg-zinc-700 mx-3"></div>
        
        <!-- Exit Admin -->
        <a href="/" class="text-sm text-zinc-400 hover:text-indigo-300 flex items-center gap-1.5 transition px-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 17l-5-5m0 0l5-5m-5 5h12"/>
          </svg>
          <span class="hidden lg:inline">Exit</span>
        </a>
        
        <!-- User Avatar -->
        <div class="relative ml-2" id="admin-account-container">
          <button id="admin-account-btn" onclick="toggleAdminAccountMenu()" class="w-8 h-8 rounded-full bg-indigo-600 flex items-center justify-center text-sm font-bold hover:ring-2 hover:ring-indigo-500/50 transition overflow-hidden">
            <img id="admin-account-avatar-img" src="" alt="" class="hidden w-full h-full object-cover">
            <span id="admin-account-avatar-initial">?</span>
          </button>
          
          <div id="admin-account-dropdown" class="hidden absolute top-full right-0 mt-2 w-60 bg-zinc-900 border border-zinc-700 rounded-xl shadow-2xl overflow-hidden z-50">
            <div class="p-3 border-b border-zinc-800 bg-zinc-950/50">
              <p id="admin-account-email" class="text-sm font-medium truncate">Loading...</p>
              <p class="text-xs text-zinc-500">Administrator</p>
            </div>
            <div class="p-1.5">
              <a id="admin-profile-link" href="/user/profile" class="dropdown-item">
                ğŸ‘¤ My Profile
              </a>
              <a id="admin-my-prints-link" href="/my-requests" class="dropdown-item">
                ğŸ–¨ï¸ My Prints
              </a>
            </div>
            <div class="border-t border-zinc-800 p-1.5">
              <a href="/admin/logout" class="dropdown-item text-red-400 hover:bg-red-900/20">
                <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                </svg>
                Sign Out
              </a>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Mobile Menu Button -->
      <button id="mobile-menu-btn" class="md:hidden p-2 text-zinc-400 hover:text-white rounded-lg hover:bg-zinc-800 transition" onclick="toggleMobileMenu()">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
        </svg>
      </button>
    </div>
  </div>
  
  <!-- Mobile Menu -->
  <div id="mobile-menu" class="hidden md:hidden border-t border-zinc-800 bg-zinc-900/95 backdrop-blur-lg max-h-[70vh] overflow-y-auto">
    <div class="p-3 space-y-1">
      <a href="/admin" class="mobile-nav-link {% if active_page == 'queue' %}active{% endif %}">ğŸ“‹ Queue</a>
      <a href="/admin/shipping" class="mobile-nav-link {% if active_page == 'shipping' %}active{% endif %}">ğŸ“¦ Shipping</a>
      {% if can_design_nav %}
      <a href="/admin?design=1" class="mobile-nav-link {% if active_page == 'design' %}active{% endif %}">ğŸ¨ Design Queue</a>
      {% endif %}
      <a href="/admin/store" class="mobile-nav-link {% if active_page == 'store' %}active{% endif %}">ğŸª Store</a>
      <a href="/admin/analytics" class="mobile-nav-link {% if active_page == 'analytics' %}active{% endif %}">ğŸ“Š Analytics</a>
      <a href="/admin/accounts" class="mobile-nav-link {% if active_page == 'accounts' %}active{% endif %}">ğŸ‘¥ Users</a>
      
      <div class="border-t border-zinc-800 my-2 pt-2">
        <p class="text-xs text-zinc-500 px-3 mb-1">Settings</p>
        <a href="/admin/printer-settings" class="mobile-nav-link {% if active_page == 'printers' %}active{% endif %}">ğŸ–¨ï¸ Printers</a>
        <a href="/admin/settings" class="mobile-nav-link {% if active_page == 'settings' %}active{% endif %}">âš™ï¸ Settings</a>
        <a href="/admin/features" class="mobile-nav-link {% if active_page == 'features' %}active{% endif %}">âœ¨ Features</a>
        <a href="/admin/printellect/devices" class="mobile-nav-link {% if active_page == 'printellect-devices' %}active{% endif %}">ğŸ“Ÿ Printellect Devices</a>
        <a href="/admin/printellect/releases" class="mobile-nav-link {% if active_page == 'printellect-releases' %}active{% endif %}">ğŸ“¦ Printellect Releases</a>
        <a href="/admin/feedback" class="mobile-nav-link {% if active_page == 'feedback' %}active{% endif %}">ğŸ“¬ Feedback</a>
        <a href="/admin/broadcast" class="mobile-nav-link {% if active_page == 'broadcast' %}active{% endif %}">ğŸ“¢ Broadcast</a>
      </div>
      
      <div class="border-t border-zinc-800 my-2 pt-2 flex items-center gap-2">
        <a href="/" class="mobile-nav-link flex-1 text-indigo-400">â† Exit Admin</a>
        <a href="/admin/logout" class="mobile-nav-link text-red-400">Logout</a>
      </div>
    </div>
  </div>
</nav>

<style>
  .admin-pill {
    display: flex;
    align-items: center;
    gap: 0.375rem;
    padding: 0.5rem 0.75rem;
    border-radius: 0.5rem;
    font-size: 0.8125rem;
    font-weight: 500;
    color: #a1a1aa;
    transition: all 0.15s;
    white-space: nowrap;
  }
  .admin-pill:hover { color: white; background-color: rgba(255,255,255,0.05); }
  .admin-pill.active { 
    color: white; 
    background-color: rgba(99, 102, 241, 0.2);
    box-shadow: inset 0 0 0 1px rgba(99, 102, 241, 0.3);
  }
  
  .dropdown-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 0.75rem;
    border-radius: 0.375rem;
    font-size: 0.8125rem;
    color: #d4d4d8;
    transition: all 0.15s;
  }
  .dropdown-item:hover { background-color: #27272a; color: white; }
  .dropdown-item.active { color: #818cf8; background-color: rgba(99, 102, 241, 0.1); }
  
  .mobile-nav-link {
    display: block;
    padding: 0.625rem 0.75rem;
    border-radius: 0.5rem;
    font-size: 0.9375rem;
    color: #d4d4d8;
    transition: all 0.15s;
  }
  .mobile-nav-link:hover { background-color: #27272a; color: white; }
  .mobile-nav-link.active { color: #818cf8; background-color: rgba(99, 102, 241, 0.1); }
</style>

<!-- Mobile Bottom Nav for Admin -->
<nav class="fixed bottom-0 left-0 right-0 z-50 bg-zinc-900/95 backdrop-blur-lg border-t border-zinc-800 sm:hidden" style="padding-bottom: calc(env(safe-area-inset-bottom, 0px) + 8px);">
  <div class="grid grid-cols-5 gap-1 px-2 pt-2">
    <a href="/admin" class="admin-bnav-item {% if active_page == 'queue' %}active{% endif %}">
      <span class="text-lg">ğŸ“‹</span>
      <span class="text-[10px]">Queue</span>
    </a>
    <a href="/" class="admin-bnav-item">
      <span class="text-lg">â•</span>
      <span class="text-[10px]">Submit</span>
    </a>
    <a href="/admin/store" class="admin-bnav-item {% if active_page == 'store' %}active{% endif %}">
      <span class="text-lg">ğŸª</span>
      <span class="text-[10px]">Store</span>
    </a>
    <a href="/admin/printer-settings" class="admin-bnav-item {% if active_page == 'printers' %}active{% endif %}">
      <span class="text-lg">ğŸ–¨ï¸</span>
      <span class="text-[10px]">Printers</span>
    </a>
    <button onclick="toggleMobileMenu()" class="admin-bnav-item text-zinc-400">
      <span class="text-lg">â˜°</span>
      <span class="text-[10px]">More</span>
    </button>
  </div>
</nav>

<style>
  .admin-bnav-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 0.5rem;
    color: #a1a1aa;
    transition: all 0.15s;
    -webkit-tap-highlight-color: transparent;
  }
  .admin-bnav-item:active { transform: scale(0.95); }
  .admin-bnav-item.active { color: #818cf8; }
</style>

<script>
function toggleMobileMenu() {
  document.getElementById('mobile-menu').classList.toggle('hidden');
}

function toggleMoreDropdown() {
  const dropdown = document.getElementById('more-dropdown');
  const chevron = document.getElementById('more-chevron');
  dropdown.classList.toggle('hidden');
  chevron.style.transform = dropdown.classList.contains('hidden') ? '' : 'rotate(180deg)';
}

function toggleAdminAccountMenu() {
  document.getElementById('admin-account-dropdown').classList.toggle('hidden');
}

// Close dropdowns when clicking outside
document.addEventListener('click', (e) => {
  const moreContainer = document.getElementById('more-dropdown-container');
  const moreDropdown = document.getElementById('more-dropdown');
  const accountContainer = document.getElementById('admin-account-container');
  const accountDropdown = document.getElementById('admin-account-dropdown');
  
  if (moreDropdown && moreContainer && !moreContainer.contains(e.target)) {
    moreDropdown.classList.add('hidden');
    document.getElementById('more-chevron').style.transform = '';
  }
  if (accountDropdown && accountContainer && !accountContainer.contains(e.target)) {
    accountDropdown.classList.add('hidden');
  }
});

// Load user info
async function loadAdminAccountInfo() {
  try {
    const resp = await fetch('/api/user/me', { credentials: 'include' });
    if (resp.ok) {
      const data = await resp.json();
      if (data.user && data.user.email) {
        const displayName = data.user.display_name || data.user.email;
        const initial = displayName[0].toUpperCase();
        
        document.getElementById('admin-account-avatar-initial').textContent = initial;
        document.getElementById('admin-account-email').textContent = data.user.email;
        
        if (data.user.avatar_url) {
          const img = document.getElementById('admin-account-avatar-img');
          img.src = data.user.avatar_url;
          img.classList.remove('hidden');
          document.getElementById('admin-account-avatar-initial').classList.add('hidden');
        }
        
        const token = localStorage.getItem('my_requests_token') || data.user.token;
        if (token) {
          const profileLink = document.getElementById('admin-profile-link');
          const myPrintsLink = document.getElementById('admin-my-prints-link');
          if (profileLink) profileLink.href = '/user/profile?token=' + token;
          if (myPrintsLink) myPrintsLink.href = '/my-requests/view?token=' + token;
        }
      }
    }
  } catch (e) {}
}
loadAdminAccountInfo();

// Bottom padding for mobile
(function() {
  if (window.innerWidth < 640) {
    document.body.style.paddingBottom = 'calc(80px + env(safe-area-inset-bottom, 0px))';
  }
})();
</script>
