<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>My Devices | Printellect</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root {
      --bg: #0c181e;
      --panel: #13232d;
      --line: #2a4756;
      --text: #e2edf2;
      --muted: #90a9b6;
      --accent: #3ad5a8;
      --warn: #ffb35b;
    }
    body { font-family: "Space Grotesk", sans-serif; color: var(--text); background: radial-gradient(1200px 650px at -10% -10%, #1d3442 0%, var(--bg) 60%); }
    .mono { font-family: "IBM Plex Mono", monospace; }
  </style>
</head>
<body>
  <main class="max-w-6xl mx-auto px-4 py-6 md:px-6 md:py-8 space-y-4">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-xs uppercase tracking-[0.2em]" style="color:var(--accent)">Control Center</p>
        <h1 class="text-2xl md:text-3xl font-semibold">My Devices</h1>
      </div>
      <a href="/printellect/add-device" class="rounded-lg px-3 py-2 text-sm font-semibold" style="background:var(--accent);color:#042116">Add Device</a>
    </div>

    <div id="list" class="grid gap-3"></div>
  </main>

  <script>
    async function loadDevices() {
      const resp = await fetch('/api/printellect/devices');
      const data = await resp.json();
      const root = document.getElementById('list');
      root.innerHTML = '';
      for (const d of (data.devices || [])) {
        const card = document.createElement('div');
        card.className = 'rounded-2xl border p-4';
        card.style.borderColor = 'var(--line)';
        card.style.background = 'var(--panel)';
        const stateColor = d.online ? '#2bcf86' : '#9ab0bb';
        card.innerHTML = `
          <div class="flex items-start justify-between gap-3">
            <div>
              <div class="font-semibold">${d.name || d.device_id}</div>
              <div class="text-xs mono" style="color:var(--muted)">${d.device_id}</div>
            </div>
            <span class="text-xs px-2 py-1 rounded-full flex items-center gap-2" style="background:#102029;color:${stateColor}">
              <span class="inline-block h-2 w-2 rounded-full" style="background:${stateColor}"></span>${d.online ? 'online' : 'offline'}
            </span>
          </div>
          <div class="grid grid-cols-3 gap-2 mt-3 text-xs">
            <div class="rounded-lg border p-2 mono" style="border-color:var(--line);background:#0f1c25;color:var(--muted)">FW ${d.fw_version || '-'}</div>
            <div class="rounded-lg border p-2 mono" style="border-color:var(--line);background:#0f1c25;color:var(--muted)">APP ${d.app_version || '-'}</div>
            <div class="rounded-lg border p-2 mono" style="border-color:var(--line);background:#0f1c25;color:var(--muted)">RSSI ${d.rssi ?? '-'}</div>
          </div>
          <a class="inline-block mt-3 text-xs underline" style="color:var(--warn)" href="/printellect/devices/${d.device_id}">Open device</a>
        `;
        root.appendChild(card);
      }
    }
    loadDevices();
    setInterval(loadDevices, 5000);
  </script>
</body>
</html>
