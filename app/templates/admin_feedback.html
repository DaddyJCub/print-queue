<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Feedback | Admin | Printellect</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-zinc-950 text-zinc-100">
  <div class="max-w-7xl mx-auto p-6">
    <!-- Navigation -->
    {% set active_page = 'feedback' %}
    {% include 'admin_nav.html' %}
    
    <!-- Page Header -->
    <div class="flex items-center justify-between mb-6">
      <div>
        <h1 class="text-3xl font-bold">ğŸ“¬ Feedback</h1>
        <p class="text-zinc-400 mt-1">Bug reports and suggestions from users</p>
      </div>
    </div>

    <!-- Status Filter Tabs -->
    <div class="flex gap-2 mb-6 flex-wrap">
      <a href="/admin/feedback" 
         class="px-4 py-2 rounded-lg text-sm font-medium transition
           {% if not status_filter %}bg-indigo-600 text-white{% else %}bg-zinc-800 text-zinc-300 hover:bg-zinc-700{% endif %}">
        All
        <span class="ml-1 px-1.5 py-0.5 rounded text-xs {% if not status_filter %}bg-indigo-500{% else %}bg-zinc-700{% endif %}">
          {{ (status_counts.get('new', 0) + status_counts.get('reviewed', 0) + status_counts.get('resolved', 0) + status_counts.get('dismissed', 0)) }}
        </span>
      </a>
      <a href="/admin/feedback?status=new" 
         class="px-4 py-2 rounded-lg text-sm font-medium transition
           {% if status_filter == 'new' %}bg-amber-600 text-white{% else %}bg-zinc-800 text-zinc-300 hover:bg-zinc-700{% endif %}">
        ğŸ†• New
        {% if status_counts.get('new', 0) > 0 %}
          <span class="ml-1 px-1.5 py-0.5 rounded text-xs {% if status_filter == 'new' %}bg-amber-500{% else %}bg-amber-600/50 text-amber-300{% endif %}">
            {{ status_counts.get('new', 0) }}
          </span>
        {% endif %}
      </a>
      <a href="/admin/feedback?status=reviewed" 
         class="px-4 py-2 rounded-lg text-sm font-medium transition
           {% if status_filter == 'reviewed' %}bg-blue-600 text-white{% else %}bg-zinc-800 text-zinc-300 hover:bg-zinc-700{% endif %}">
        ğŸ‘€ Reviewed
        {% if status_counts.get('reviewed', 0) > 0 %}
          <span class="ml-1 px-1.5 py-0.5 rounded text-xs bg-zinc-700">{{ status_counts.get('reviewed', 0) }}</span>
        {% endif %}
      </a>
      <a href="/admin/feedback?status=resolved" 
         class="px-4 py-2 rounded-lg text-sm font-medium transition
           {% if status_filter == 'resolved' %}bg-emerald-600 text-white{% else %}bg-zinc-800 text-zinc-300 hover:bg-zinc-700{% endif %}">
        âœ… Resolved
        {% if status_counts.get('resolved', 0) > 0 %}
          <span class="ml-1 px-1.5 py-0.5 rounded text-xs bg-zinc-700">{{ status_counts.get('resolved', 0) }}</span>
        {% endif %}
      </a>
      <a href="/admin/feedback?status=dismissed" 
         class="px-4 py-2 rounded-lg text-sm font-medium transition
           {% if status_filter == 'dismissed' %}bg-zinc-600 text-white{% else %}bg-zinc-800 text-zinc-300 hover:bg-zinc-700{% endif %}">
        ğŸš« Dismissed
        {% if status_counts.get('dismissed', 0) > 0 %}
          <span class="ml-1 px-1.5 py-0.5 rounded text-xs bg-zinc-700">{{ status_counts.get('dismissed', 0) }}</span>
        {% endif %}
      </a>
    </div>

    <!-- Feedback List -->
    {% if feedback|length == 0 %}
      <div class="bg-zinc-900/50 border border-zinc-800 rounded-xl p-12 text-center">
        <div class="text-4xl mb-4">ğŸ“­</div>
        <h3 class="text-lg font-semibold text-zinc-300">No feedback yet</h3>
        <p class="text-zinc-500 mt-2">
          {% if status_filter %}
            No {{ status_filter }} feedback to show.
          {% else %}
            When users submit bug reports or suggestions, they'll appear here.
          {% endif %}
        </p>
      </div>
    {% else %}
      <div class="space-y-4">
        {% for fb in feedback %}
          <div class="bg-zinc-900/50 border border-zinc-800 rounded-xl p-5 
                      {% if fb.status == 'new' %}border-l-4 border-l-amber-500{% endif %}">
            <div class="flex items-start justify-between gap-4">
              <div class="flex-1">
                <!-- Header -->
                <div class="flex items-center gap-3 mb-3">
                  {% if fb.type == 'bug' %}
                    <span class="px-2 py-1 rounded-lg text-xs font-medium bg-red-900/30 text-red-300 border border-red-700/50">
                      ğŸ› Bug Report
                    </span>
                  {% else %}
                    <span class="px-2 py-1 rounded-lg text-xs font-medium bg-purple-900/30 text-purple-300 border border-purple-700/50">
                      ğŸ’¡ Suggestion
                    </span>
                  {% endif %}
                  
                  {% if fb.status == 'new' %}
                    <span class="px-2 py-1 rounded-lg text-xs font-medium bg-amber-900/30 text-amber-300 border border-amber-700/50">
                      ğŸ†• New
                    </span>
                  {% elif fb.status == 'reviewed' %}
                    <span class="px-2 py-1 rounded-lg text-xs font-medium bg-blue-900/30 text-blue-300 border border-blue-700/50">
                      ğŸ‘€ Reviewed
                    </span>
                  {% elif fb.status == 'resolved' %}
                    <span class="px-2 py-1 rounded-lg text-xs font-medium bg-emerald-900/30 text-emerald-300 border border-emerald-700/50">
                      âœ… Resolved
                    </span>
                  {% elif fb.status == 'dismissed' %}
                    <span class="px-2 py-1 rounded-lg text-xs font-medium bg-zinc-700/50 text-zinc-400 border border-zinc-600/50">
                      ğŸš« Dismissed
                    </span>
                  {% endif %}
                  
                  <span class="text-xs text-zinc-500">{{ fb.created_at[:16].replace('T', ' ') }}</span>
                </div>

                <!-- From -->
                <div class="text-sm text-zinc-400 mb-2">
                  <span class="font-medium text-zinc-200">{{ fb.name or 'Anonymous' }}</span>
                  {% if fb.email %}
                    <span class="text-zinc-500">â€¢</span>
                    <a href="mailto:{{ fb.email }}" class="text-indigo-400 hover:underline">{{ fb.email }}</a>
                  {% endif %}
                </div>

                <!-- Message -->
                <div class="bg-zinc-950/60 rounded-lg p-4 mb-3">
                  <p class="text-sm text-zinc-200 whitespace-pre-wrap">{{ fb.message }}</p>
                </div>

                <!-- Meta -->
                {% if fb.page_url %}
                  <div class="text-xs text-zinc-500 mb-2">
                    <span class="text-zinc-600">Page:</span> {{ fb.page_url[:80] }}{% if fb.page_url|length > 80 %}...{% endif %}
                  </div>
                {% endif %}
                
                {% if fb.admin_notes %}
                  <div class="bg-blue-900/20 border border-blue-800/40 rounded-lg p-3 mt-3">
                    <div class="text-xs text-blue-300 font-medium mb-1">Admin Notes:</div>
                    <p class="text-sm text-zinc-300">{{ fb.admin_notes }}</p>
                  </div>
                {% endif %}
              </div>

              <!-- Actions -->
              <div class="flex-shrink-0">
                <button onclick="toggleStatusForm('{{ fb.id }}')" 
                        class="px-3 py-1.5 rounded-lg text-xs font-medium bg-zinc-800 hover:bg-zinc-700 transition">
                  Update Status
                </button>
              </div>
            </div>

            <!-- Status Update Form (hidden by default) -->
            <div id="status-form-{{ fb.id }}" class="hidden mt-4 pt-4 border-t border-zinc-800">
              <form method="POST" action="/admin/feedback/{{ fb.id }}/status" class="flex flex-wrap gap-3 items-end">
                <div>
                  <label class="block text-xs text-zinc-400 mb-1">Status</label>
                  <select name="status" class="rounded-lg bg-zinc-950 border border-zinc-700 px-3 py-2 text-sm">
                    <option value="new" {% if fb.status == 'new' %}selected{% endif %}>ğŸ†• New</option>
                    <option value="reviewed" {% if fb.status == 'reviewed' %}selected{% endif %}>ğŸ‘€ Reviewed</option>
                    <option value="resolved" {% if fb.status == 'resolved' %}selected{% endif %}>âœ… Resolved</option>
                    <option value="dismissed" {% if fb.status == 'dismissed' %}selected{% endif %}>ğŸš« Dismissed</option>
                  </select>
                </div>
                <div class="flex-1 min-w-[200px]">
                  <label class="block text-xs text-zinc-400 mb-1">Admin Notes (optional)</label>
                  <input type="text" name="admin_notes" value="{{ fb.admin_notes or '' }}"
                         class="w-full rounded-lg bg-zinc-950 border border-zinc-700 px-3 py-2 text-sm"
                         placeholder="Add a note..." />
                </div>
                <button type="submit" class="px-4 py-2 rounded-lg bg-indigo-600 hover:bg-indigo-500 text-sm font-medium transition">
                  Save
                </button>
              </form>
            </div>
          </div>
        {% endfor %}
      </div>
    {% endif %}

    <!-- Footer -->
    <div class="mt-8 pt-4 border-t border-zinc-800 text-center text-xs text-zinc-500">
      <a href="/changelog" class="hover:text-indigo-400 transition">Printellect v{{ version }}</a>
    </div>
  </div>

  <script>
    function toggleStatusForm(id) {
      const form = document.getElementById('status-form-' + id);
      form.classList.toggle('hidden');
    }
  </script>
</body>
</html>
