{# 
  Loading States Component
  Includes skeleton loaders and loading buttons
  
  Usage:
    {% from '_components/loading.html' import skeleton_card, skeleton_list, loading_button, skeleton_queue_card, skeleton_stat_card %}
#}

{# Queue stat card skeleton #}
{% macro skeleton_stat_card() %}
<div class="bg-zinc-800/50 rounded-2xl p-4 text-center border border-zinc-700/50">
  <div class="h-7 skeleton w-8 mx-auto mb-2"></div>
  <div class="h-3 skeleton w-12 mx-auto"></div>
</div>
{% endmacro %}

{# Queue card skeleton (mobile view) #}
{% macro skeleton_queue_card() %}
<div class="bg-zinc-900/60 border border-zinc-800 rounded-xl p-4">
  <div class="flex items-start justify-between mb-2">
    <div class="flex items-center gap-2">
      <div class="w-8 h-6 skeleton"></div>
      <div>
        <div class="h-5 skeleton w-32 mb-1"></div>
        <div class="h-3 skeleton w-20"></div>
      </div>
    </div>
    <div class="h-6 skeleton w-16 rounded-lg"></div>
  </div>
  <div class="flex items-center gap-3 text-xs">
    <div class="h-3 skeleton w-16"></div>
    <div class="h-3 skeleton w-12"></div>
    <div class="h-3 skeleton w-14"></div>
  </div>
</div>
{% endmacro %}

{# Card skeleton for request cards #}
{% macro skeleton_card() %}
<div class="bg-zinc-800/50 rounded-xl p-4 border border-zinc-700/50 animate-pulse">
  <div class="flex items-start gap-4">
    <!-- Thumbnail skeleton -->
    <div class="w-20 h-20 rounded-lg bg-zinc-700/50 flex-shrink-0"></div>
    <div class="flex-1 min-w-0">
      <!-- Title -->
      <div class="h-5 bg-zinc-700/50 rounded w-3/4 mb-2"></div>
      <!-- Status badge -->
      <div class="h-5 bg-zinc-700/50 rounded w-20 mb-3"></div>
      <!-- Meta info -->
      <div class="flex gap-3">
        <div class="h-4 bg-zinc-700/50 rounded w-16"></div>
        <div class="h-4 bg-zinc-700/50 rounded w-24"></div>
      </div>
    </div>
  </div>
</div>
{% endmacro %}

{# Table row skeleton for admin queue #}
{% macro skeleton_row() %}
<tr class="animate-pulse">
  <td class="px-4 py-3"><div class="h-4 bg-zinc-700/50 rounded w-24"></div></td>
  <td class="px-4 py-3"><div class="h-4 bg-zinc-700/50 rounded w-32"></div></td>
  <td class="px-4 py-3"><div class="h-5 bg-zinc-700/50 rounded w-16"></div></td>
  <td class="px-4 py-3"><div class="h-4 bg-zinc-700/50 rounded w-20"></div></td>
  <td class="px-4 py-3"><div class="h-8 bg-zinc-700/50 rounded w-16"></div></td>
</tr>
{% endmacro %}

{# List skeleton - multiple cards #}
{% macro skeleton_list(count=3) %}
<div class="space-y-4">
  {% for _ in range(count) %}
  {{ skeleton_card() }}
  {% endfor %}
</div>
{% endmacro %}

{# Grid skeleton for store items #}
{% macro skeleton_grid_item() %}
<div class="bg-zinc-800/50 rounded-xl overflow-hidden border border-zinc-700/50 animate-pulse">
  <!-- Image skeleton -->
  <div class="aspect-square bg-zinc-700/50"></div>
  <div class="p-4">
    <!-- Title -->
    <div class="h-5 bg-zinc-700/50 rounded w-3/4 mb-2"></div>
    <!-- Price -->
    <div class="h-6 bg-zinc-700/50 rounded w-16 mb-3"></div>
    <!-- Button -->
    <div class="h-10 bg-zinc-700/50 rounded w-full"></div>
  </div>
</div>
{% endmacro %}

{# Loading button replacement content #}
{% macro loading_spinner(size='sm') %}
{% set sizes = {
  'xs': 'w-3 h-3',
  'sm': 'w-4 h-4',
  'md': 'w-5 h-5',
  'lg': 'w-6 h-6'
} %}
<svg class="{{ sizes.get(size, sizes.sm) }} animate-spin" fill="none" viewBox="0 0 24 24">
  <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
  <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
</svg>
{% endmacro %}

{# Inline loading indicator #}
{% macro loading_inline(text='Loading...') %}
<div class="flex items-center justify-center gap-2 py-4 text-zinc-400">
  {{ loading_spinner('sm') }}
  <span class="text-sm">{{ text }}</span>
</div>
{% endmacro %}

{# Full page loading overlay #}
{% macro loading_overlay(text='Loading...') %}
<div class="fixed inset-0 bg-zinc-900/80 backdrop-blur-sm flex items-center justify-center z-[9999]">
  <div class="text-center">
    <div class="w-12 h-12 mx-auto mb-4">
      <svg class="w-full h-full animate-spin text-teal-400" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
      </svg>
    </div>
    <p class="text-zinc-300 font-medium">{{ text }}</p>
  </div>
</div>
{% endmacro %}


{# === JavaScript helpers for button loading states === #}
<script>
// Add loading state to a button
function setButtonLoading(button, loadingText = 'Loading...') {
  // Store original content
  button.dataset.originalContent = button.innerHTML;
  button.dataset.originalDisabled = button.disabled;
  
  // Set loading state
  button.disabled = true;
  button.innerHTML = `
    <svg class="w-4 h-4 animate-spin" fill="none" viewBox="0 0 24 24">
      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
    </svg>
    <span>${loadingText}</span>
  `;
  button.classList.add('opacity-75', 'cursor-wait', 'flex', 'items-center', 'justify-center', 'gap-2');
}

// Remove loading state from button
function resetButton(button) {
  if (button.dataset.originalContent) {
    button.innerHTML = button.dataset.originalContent;
    button.disabled = button.dataset.originalDisabled === 'true';
    button.classList.remove('opacity-75', 'cursor-wait');
    delete button.dataset.originalContent;
    delete button.dataset.originalDisabled;
  }
}

// Auto-loading for forms
document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('form[data-loading]').forEach(form => {
    form.addEventListener('submit', (e) => {
      const submitBtn = form.querySelector('button[type="submit"], input[type="submit"]');
      if (submitBtn && !submitBtn.disabled) {
        const loadingText = form.dataset.loading || 'Submitting...';
        setButtonLoading(submitBtn, loadingText);
      }
    });
  });
});

// Make globally available
window.setButtonLoading = setButtonLoading;
window.resetButton = resetButton;
</script>
